import { Canvas, Story, Subtitle, ArgsTable } from '@storybook/addon-docs/blocks';
import { DtPopover } from './';

# Popovers

<Subtitle>
  Popovers are a generic component that conditionally displays a content overlay in-line with an anchor element.
</Subtitle>

## Basic Usage

Popovers may be used standalone, or to create a dropdown menu or other complex control. Popovers are not modal elements,
for a modal dialog that takes over the whole screen, use a DtModal component.

A popover has 2 major pieces that are provided as required named slots: the **anchor** and the **content**.

The **anchor** is the control that the content will be positioned relative to and triggers the visibility of the
content. Normally a button, the anchor can be any *interactive* element that could control the visibility of the popover
content. For example, the anchor could be an input element with a conditionally displayed listbox content element to
implement an auto-suggest form component.

The **content** slot will be rendered lazily when the popover is open. The popover content will automatically be closed
when clicking outside the content (using the click-outside directive) so it is important to use `.sync` on the `show`
prop (or `v-model:open` in Vue 3) so it can be updated if the popover closes itself.

### Import

```jsx
import { DtPopover } from '@dialpad/dialtone-vue';
```

### Basic usage with named slots

```jsx
<dt-popover
  :open.sync="open"
>
  <template #anchor="{ attrs }">
    <dt-button
      v-bind="attrs"
      @click="open = !open"
    >
      Click to open
    </dt-button>
  </template>
  <template #content>
    <p>I will be displayed in the popover!</p>
  </template>
</dt-popover>
```

<Canvas>
  <Story id="components-popovers--default" />
</Canvas>

## Accessibility

There are a few important considerations to ensure popover controls are accessible. By default, the popover content will
have a generic role of "dialog".

### Anchor

The anchor element that activates the popover should be fully accessible by keyboard. The easiest way to do this is by
using an element like an `DtButton` that is already accessible. The user should also be able to close the popover
content using the `ESC` key for most ARIA roles.

There are some required ARIA attributes for the anchor element (such as `aria-expanded` set based on `open` and
`aria-haspopup` that matches the `role`). To make this as straightforward as possible, these ARIA attributes are passed
with the correct values as the `attrs` slot-scope to the anchor slot. Applying them is as simple as using `v-bind`:

```jsx
<template #anchor="{ attrs }">
  <dt-button v-bind="attrs">I'm accessible now!</dt-button>
</template>
```

By default, the dialog content will be labeled by the entire anchor element. To change this, you can do one of 2 things:

1. Pass `aria-label`, which is the text label that will be applied to the dialog content.
2. Pass `aria-labelledby`, which is an ID of the element that should be used as the descriptive label.

### Focus & Keyboard

Due to the different contexts in which a popover can be used, focus management and keyboard shortcuts like `ESC` are not
provided for you. You are encouraged to consult the ARIA documentation for the particular role you are implementing to
see how keyboard focus & shortcuts should be implemented.

## Variants

### Dynamic alignment

The popover content supports both fixed and dynamic horizontal and vertical alignment around the anchor element. If
`fixedAlignment`/`fixedVerticalAlignment` are passed, the popover will always be positioned in that direction. If you
omit either of them, the popover will dynamically adjust the corresponding position, trying not to clip the content
relative to the `$root` element (**not** the viewport!). This calculation happens each time the popover is opened
(not when the screen is resized).

For example: with no `fixedAlignment`, a popover anchor positioned such that the content, when open, would overflow the
`$root` element's right bounds will open to the left.

<Canvas>
  <Story id="components-popovers--fixed-right" />
</Canvas>

### Padding

Padding options for the popover content are provided via size classes `small`/`medium`/`large` in order to standardize
the look of the popover content between usages. To remove the padding from the content, you can pass `none`:

<Canvas>
  <Story id="components-popovers--no-padding" />
</Canvas>

## Props, Slots & Events

<ArgsTable of={DtPopover} />
